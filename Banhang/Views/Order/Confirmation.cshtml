@model Banhang.Models.Order
@{
    ViewData["Title"] = "ƒê·∫∑t h√†ng th√†nh c√¥ng";
}

<div class="page-hero gradient-bg py-5 text-white text-center position-relative overflow-hidden">
    <div class="floating-shape shape1"></div>
    <div class="floating-shape shape2"></div>
    <div class="floating-shape shape3"></div>
    <div class="container position-relative">
        <h1 class="display-5 fw-bold mb-2">ƒê·∫∑t h√†ng th√†nh c√¥ng! üéâ</h1>
        <p class="lead mb-0">M√£ ƒë∆°n h√†ng c·ªßa b·∫°n l√† <strong>#@Model.OrderID</strong>. Ch√∫ng t√¥i s·∫Ω g·ª≠i th√¥ng b√°o khi tr·∫°ng th√°i thay ƒë·ªïi.</p>
    </div>
</div>

<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-7">
                <div class="glass-card p-4 shadow-lg">
                    <h2 class="h4 mb-3 text-gradient">Th√¥ng tin ƒë∆°n h√†ng</h2>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2">üìÖ <strong>Ng√†y ƒë·∫∑t:</strong> @Model.OrderDate.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</li>
                        <li class="mb-2">üöö <strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-gradient text-white">@Model.Status</span></li>
                        <li class="mb-2">üë§ <strong>Ng∆∞·ªùi nh·∫≠n:</strong> @Model.ShipName</li>
                        <li class="mb-2">üìû <strong>Li√™n h·ªá:</strong> @Model.ShipPhone</li>
                        <li class="mb-2">üìç <strong>ƒê·ªãa ch·ªâ:</strong> @Model.ShipAddress</li>
                        @if (!string.IsNullOrWhiteSpace(Model.Notes))
                        {
                            <li class="mb-2">üìù <strong>Ghi ch√∫:</strong> @Model.Notes</li>
                        }
                    </ul>

                    <h3 class="h5 mb-3 text-gradient">S·∫£n ph·∫©m</h3>
                    <div class="list-group list-group-flush">
                        @foreach (var item in Model.Items)
                        {
                            <div class="list-group-item bg-transparent border-0 d-flex align-items-center gap-3">
                                <div class="rounded-4 overflow-hidden" style="width: 72px; height: 72px;">
                                    <img src="@(string.IsNullOrEmpty(item.ImageUrl) ? "https://via.placeholder.com/150" : item.ImageUrl)" class="img-fluid h-100 w-100 object-fit-cover" alt="@item.ProductName" />
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold">@item.ProductName</div>
                                    <small class="text-muted">S·ªë l∆∞·ª£ng: @item.Quantity</small>
                                </div>
                                <div class="fw-bold text-end text-gradient">@item.LineTotal.ToString("#,0")ƒë</div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="glass-card p-4 shadow-lg h-100">
                    <h2 class="h4 mb-3 text-gradient">T·ªïng thanh to√°n</h2>
                    <div class="display-6 text-gradient">@Model.TotalAmount.ToString("#,0")ƒë</div>
                    <p class="text-muted mt-3">Email x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ªõi <strong>@(Model.Email ?? "email c·ªßa b·∫°n")</strong>. N·∫øu c√≥ th·∫Øc m·∫Øc, vui l√≤ng li√™n h·ªá hotline h·ªó tr·ª£ 24/7.</p>
                    <div class="mt-4">
                        <h3 class="h6 text-uppercase text-muted mb-2">Tr·∫°ng th√°i ƒë∆°n h√†ng</h3>
                        @{ 
                            string[] timelineOrder = { "Pending", "Processing", "Shipped", "Delivered" };
                            int detectedIndex = Array.IndexOf(timelineOrder, Model.Status ?? string.Empty);
                            var normalizedStatus = detectedIndex >= 0 ? timelineOrder[detectedIndex] : "Pending";
                            if (string.Equals(Model.Status, "Cancelled", StringComparison.OrdinalIgnoreCase))
                            {
                                normalizedStatus = "Processing";
                            }
                            int currentIndex = Array.IndexOf(timelineOrder, normalizedStatus);
                            Func<string, string> getTimelineClass = stage =>
                            {
                                int stageIndex = Array.IndexOf(timelineOrder, stage);
                                if (string.Equals(Model.Status, "Cancelled", StringComparison.OrdinalIgnoreCase))
                                {
                                    if (stage == "Pending")
                                    {
                                        return "completed";
                                    }
                                    if (stage == "Processing")
                                    {
                                        return "current";
                                    }
                                    return string.Empty;
                                }

                                if (currentIndex > stageIndex)
                                {
                                    return "completed";
                                }

                                if (currentIndex == stageIndex)
                                {
                                    return "current";
                                }

                                return string.Empty;
                            };
                        }
                        <ul class="timeline list-unstyled ps-3">
                            <li class="timeline-item @getTimelineClass("Pending")">Ti·∫øp nh·∫≠n ƒë∆°n h√†ng</li>
                            <li class="timeline-item @getTimelineClass("Processing")">ƒêang x·ª≠ l√Ω</li>
                            <li class="timeline-item @getTimelineClass("Shipped")">ƒêang giao</li>
                            <li class="timeline-item @getTimelineClass("Delivered")">Ho√†n t·∫•t</li>
                        </ul>
                    </div>
                    <a asp-controller="Home" asp-action="Index" class="btn btn-gradient btn-lg mt-4 w-100">Ti·∫øp t·ª•c mua s·∫Øm</a>
                    <a asp-controller="Account" asp-action="Profile" class="btn btn-outline-light btn-lg mt-2 w-100">Xem l·ªãch s·ª≠ ƒë∆°n h√†ng</a>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-lg-8 mx-auto">
                <div class="glass-card p-4 shadow-sm">
                    <h3 class="h5 text-gradient mb-3">B∆∞·ªõc ti·∫øp theo</h3>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="next-step-card">
                                <span class="step-number">1</span>
                                <p class="mb-0">Ki·ªÉm tra email x√°c nh·∫≠n v√† ƒë·∫£m b·∫£o th√¥ng tin giao h√†ng ch√≠nh x√°c.</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="next-step-card">
                                <span class="step-number">2</span>
                                <p class="mb-0">Theo d√µi ti·∫øn tr√¨nh trong m·ª•c <strong>ƒê∆°n h√†ng c·ªßa t√¥i</strong> ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i m·ªõi nh·∫•t.</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="next-step-card">
                                <span class="step-number">3</span>
                                <p class="mb-0">Li√™n h·ªá ƒë·ªôi ng≈© h·ªó tr·ª£ b·∫•t c·ª© khi n√†o b·∫°n c·∫ßn tr·ª£ gi√∫p ho·∫∑c mu·ªën thay ƒë·ªïi ƒë∆°n h√†ng.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
